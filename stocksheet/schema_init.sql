CREATE TABLE IF NOT EXISTS apiusers
(
    uid       SERIAL PRIMARY KEY,
    trader    TEXT    DEFAULT NULL,
    privilege BIT(64) DEFAULT 0::BIT(64) NOT NULL
);
CREATE TABLE IF NOT EXISTS apikeys
(
    uid       INT REFERENCES apiusers (uid),
    apikey    CHAR(86) PRIMARY KEY,
    ratelimit INT DEFAULT -1 NOT NULL
);

CREATE TABLE IF NOT EXISTS stocks
(
    ticker       TEXT PRIMARY KEY,
    name         TEXT UNIQUE                NOT NULL,
    totalamount  INT              DEFAULT 0 NOT NULL,
    parvalue     INT              DEFAULT 5000,
    closingprice INT              DEFAULT 5000,
    worktype     FLOAT4 ARRAY[64] DEFAULT ARRAY [0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625,
        0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625,
        0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625,
        0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625, 0.015625]
); -- 64ê°œ

CREATE TABLE IF NOT EXISTS traders
(
    tid    SERIAL PRIMARY KEY,
    name   TEXT UNIQUE NOT NULL,
    brainv FLOAT4 ARRAY[] DEFAULT NULL
);

CREATE TABLE IF NOT EXISTS stockowns
(
    tid    INT REFERENCES traders (tid),
    ticker TEXT REFERENCES stocks (ticker),
    amount INT DEFAULT 0 NOT NULL
);

CREATE TABLE IF NOT EXISTS config
(
    key   TEXT PRIMARY KEY,
    value TEXT
);
INSERT INTO config (key, value)
VALUES ('market_variancerate_float', '0.3'),
       ('market_pricestepsize_fe', $$1 /1000 5 /5000 10 /10000 50 /50000 100 /100000 500 /500000 1000$$)
ON CONFLICT (key) DO NOTHING;
